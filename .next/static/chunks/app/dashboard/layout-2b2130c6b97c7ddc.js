(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[954],{1886:(e,t,r)=>{"use strict";async function o(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0,o="".concat("http://localhost:5000").concat(e),a={"Content-Type":"application/json",...t.headers};r&&(a.Authorization="Bearer ".concat(r));let n={...t,headers:a},s=await fetch(o,n);if(!s.ok){let e="Error ".concat(s.status,": ").concat(s.statusText);try{let t=await s.json();t.message?e=t.message:t.error?e=t.error:t.errors&&Array.isArray(t.errors)&&(e=t.errors.join(", "))}catch(e){}if(401===s.status)throw localStorage.removeItem("token"),localStorage.removeItem("user"),window.location.href="/",Error("Token inv\xe1lido");throw Error(e)}return s.json()}r.d(t,{Vg:()=>n,ZQ:()=>a,rn:()=>s});let a={login:async e=>o("/api/auth/login",{method:"POST",body:JSON.stringify(e)}),register:async e=>o("/api/auth/register",{method:"POST",body:JSON.stringify(e)}),verify:async e=>o("/api/auth/verify",{method:"GET"},e)},n=e=>({getStats:()=>o("/api/dashboard/stats",{method:"GET"},e),getRecentAppointments:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;return o("/api/dashboard/recent-appointments?limit=".concat(t),{method:"GET"},e)},getActivity:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return o("/api/dashboard/activity?limit=".concat(t),{method:"GET"},e)},getAllAppointments:()=>o("/api/citas",{method:"GET"},e)}),s=e=>({getPatients:function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:10;return o("/pacientes?page=".concat(t,"&limit=").concat(r),{method:"GET"},e)},getPatientById:t=>o("/pacientes/".concat(t),{method:"GET"},e),createPatient:t=>o("/pacientes",{method:"POST",body:JSON.stringify(t)},e),updatePatient:(t,r)=>o("/pacientes/".concat(t),{method:"PUT",body:JSON.stringify(r)},e),deletePatient:t=>o("/pacientes/".concat(t),{method:"DELETE"},e)})},2225:(e,t,r)=>{Promise.resolve().then(r.bind(r,9905))},5695:(e,t,r)=>{"use strict";var o=r(8999);r.o(o,"usePathname")&&r.d(t,{usePathname:function(){return o.usePathname}}),r.o(o,"useRouter")&&r.d(t,{useRouter:function(){return o.useRouter}})},5731:(e,t,r)=>{"use strict";r.d(t,{A:()=>u,AuthProvider:()=>c});var o=r(5155),a=r(2115),n=r(1886);let s=(0,a.createContext)(null),i="auth_token",l="auth_user",c=e=>{let{children:t}=e,[r,c]=(0,a.useState)(!1),[u,d]=(0,a.useState)(null),[g,h]=(0,a.useState)(null),[m,f]=(0,a.useState)(!0),[y,v]=(0,a.useState)(null),[p,S]=(0,a.useState)(!1);(0,a.useEffect)(()=>{S(!0)},[]),(0,a.useEffect)(()=>{p&&(async()=>{try{let e=localStorage.getItem(i),t=localStorage.getItem(l);if(e&&t)try{await n.ZQ.verify(e),h(e),d(JSON.parse(t)),c(!0),console.log("✅ Sesi\xf3n restaurada correctamente")}catch(e){console.error("❌ Token inv\xe1lido:",e),localStorage.removeItem(i),localStorage.removeItem(l),c(!1),d(null),h(null)}else console.log("ℹ️ No hay sesi\xf3n guardada"),c(!1)}catch(e){console.error("❌ Error al cargar la autenticaci\xf3n:",e),c(!1)}finally{f(!1)}})()},[p]);let b=async e=>{v(null);try{f(!0);let t=await n.ZQ.login(e),r={id:t.user._id,nombre:t.user.nombre,apellido:t.user.apellido,correo:t.user.correo,role:t.role,telefono:t.user.telefono,especialidad:t.user.especialidad};return h(t.token),d(r),c(!0),p&&(localStorage.setItem(i,t.token),localStorage.setItem(l,JSON.stringify(r))),console.log("✅ Login exitoso"),!0}catch(e){return console.error("❌ Error de inicio de sesi\xf3n:",e),v("Credenciales incorrectas. Por favor, int\xe9ntelo de nuevo."),!1}finally{f(!1)}},x=async e=>{v(null);try{return f(!0),await n.ZQ.register(e),!0}catch(e){return console.error("❌ Error de registro:",e),v("Error al registrar. Por favor, int\xe9ntelo de nuevo."),!1}finally{f(!1)}};return(0,o.jsx)(s.Provider,{value:{isAuthenticated:r,user:u,token:g,login:b,logout:()=>{c(!1),d(null),h(null),p&&(localStorage.removeItem(i),localStorage.removeItem(l)),console.log("✅ Logout exitoso")},register:x,isLoading:m,error:y,isHydrated:p},children:t})},u=()=>{let e=(0,a.useContext)(s);if(!e)throw Error("useAuth debe ser usado dentro de un AuthProvider");return e}},9905:(e,t,r)=>{"use strict";r.d(t,{default:()=>i});var o=r(5155),a=r(2115),n=r(5695),s=r(5731);function i(e){let{children:t}=e,{isAuthenticated:r,isLoading:i,isHydrated:l}=(0,s.A)(),c=(0,n.useRouter)();return((0,a.useEffect)(()=>{if(l&&!i&&!r){let e=setTimeout(()=>{c.push("/")},100);return()=>clearTimeout(e)}},[r,i,l,c]),!l||i)?(0,o.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-400 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Verificando autenticaci\xf3n..."})]})}):r?(0,o.jsx)(o.Fragment,{children:t}):(0,o.jsx)("div",{className:"h-screen flex items-center justify-center bg-gray-100 dark:bg-gray-900",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-red-400 mx-auto"}),(0,o.jsx)("p",{className:"mt-4 text-gray-600 dark:text-gray-300",children:"Redirigiendo..."})]})})}}},e=>{var t=t=>e(e.s=t);e.O(0,[441,684,358],()=>t(2225)),_N_E=e.O()}]);